<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Hotspot Map</title>

    <meta name="description" content="Hotspot map, find the right place to work.">
    <meta name="keywords" content="google,maps,google maps,hotspot maps,hotspot,work place">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Find the place to work." />
    <meta property="og:site_name" content="HotspotMap" />
    <meta property="og:description" content="Hotspot map, find the right place to work." />

    <link rel="stylesheet" href="HotspotMap/css/bootstrap.min.css">
    <link rel="stylesheet" href="HotspotMap/css/style.css">
    <link rel="stylesheet" href="HotspotMap/css/tipsy.css">
</head>

<body id="app">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="navbar-header">
            <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-map-marker"></span>Hotspot Map</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a class="headerLocation clickablePlace" href="#" id="clientPosition"><span class="glyphicon glyphicon-pushpin"></span>
                        {{ data['place'].town }} ({{ data['place'].country }})
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="core">
        <div class="settings">
            <ul>
                <li>
                    <label for="api">Address <a class="q" href="#" target="_blank" rel="tipsy" title="How HotspotMap work">?</a></label>
                    <input type="text" value="{{ data['place'].address }}" name="address" id="addressInput">
                </li>
                <li>
                    <label for="center">Spot position</label>
                    <span class="weelabel">Latitude</span>
                    <input name="lat" style="width:100px;" value="{{ data['place'].latitude }}" type="text" id="latitudeInput">
                    <hr>
                    <span class="weelabel">Longitude</span>
                    <input name="lon" style="width:100px;" value="{{ data['place'].longitude }}" type="text" id="longitudeInput">
                </li>
                <li>
                    <label for="maptype">Type of Hotspot</label>
                    <select id="maptypecontrol" name="maptypecontrol">
                        <option selected="selected">None</option>
                        <option>Company</option>
                        <option>Public spot</option>
                    </select>
                </li>
                <li>
                    <button class="generate btn">Search</button>
                </li>
            </ul>
            <ul>
                <li><label for="center">Closest spots ({{ data['closestPlaces']|length }})</label></li>
                {% for place in data['closestPlaces'] %}
                    <li>
                        <a class="weelabel clickablePlace" id="{{ place.id }}" href="#" >{{ place.name }} ({{ place.distance }} km)</a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="result">
            <div class="row">
                <div id="caract" class="col-md-6" style="display: none;">
                    <label class="subtitle">PLACE</label><br/>

                    <label class="input-type">GPS COORDINATE</label><br/>
                    <input type="text" class="form-control" placeholder="Latitude">
                    <input type="text" class="form-control" placeholder="Longitude">
                    <label class="input-type">ADDRESS</label><br/>
                    <input type="text" class="form-control big" placeholder="Street and number">
                    <input type="text" class="form-control" placeholder="Country">
                    <input type="text" class="form-control" placeholder="Town">
                </div>

                <div id="map" class="col-md-6 view"></div>
            </div>
            <div class="row">
                <div id="map-info" class="col-md-12" style="display: none;">
                    <label class="subtitle">DESCRIPTION</label><br/>


                    <input type="text" class="form-control big" placeholder="Name">
                    <input type="text" class="form-control big" placeholder="Website">
                    <textarea class="form-control big" placeholder="More information"></textarea>
                </div>
            </div>
        </div>

        <div class="overlay"></div>
        <div class="infobar">
            <a id="save-hotspot" class="hotspot-button" href="#" style="display: none;">Save</a>
            <a id="add-hotspot" class="hotspot-button" href="#">Add your Hotspot</a>
        </div>
    </div>
</body>

<!--[if IE]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="HotspotMap/js/bootstrap.min.js"></script>

<script>
    var map;

    function initialize() {
        var pos = new google.maps.LatLng({{ data['place'].latitude }}, {{ data['place'].longitude }});
        var mapOptions = {
            zoom: 13,
            center: pos,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map'), mapOptions);

        // Add current markers
        var marker = new google.maps.Marker({
            position: pos,
            map: map,
            title: '{{ data['place'].town }}',
            icon: 'Hotspotmap/images/blue_marker.png',
            zIndex: 999
        });

        // Add places markers
        {% for place in data['places'] %}
        new google.maps.Marker({
            position: new google.maps.LatLng({{ place.latitude }}, {{ place.longitude }}),
            map: map,
            title: '{{ place.town }}',
            icon: 'Hotspotmap/images/green_marker.png'
        });
        {% endfor %}
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    $("#add-hotspot").click(function() {
        $("#caract").toggle();
        $("#map-info").toggle();
        $("#save-hotspot").toggle();
        if($("#map").hasClass("view"))
        {
            $("#map").removeClass("view");
            $("#map").addClass("edit");
            $(this).text("cancel");
        }
        else
        {
            $("#map").removeClass("edit");
            $("#map").addClass("view");
            $(this).text("add your hotspot");
        }
        setTimeout(
            function()
            {
                google.maps.event.trigger(map, 'resize');
            }, 1200
        );
    });

    function updateFromClientInfo() {
        map.setCenter(new google.maps.LatLng({{ data['place'].latitude }}, {{ data['place'].longitude }}));

        $( "#addressInput" ).val( "{{ data['place'].address }}" );
        $( "#latitudeInput" ).val( {{ data['place'].latitude }} );
        $( "#longitudeInput" ).val( {{ data['place'].longitude }} );
    }

    function updateFromPlaceId(placeId) {
        $.ajax({
            url: "/place/" + placeId,
            type: "GET",
            dataType: "text",
            headers: {
                Accept : "application/json"
            }
        })
        .done(function( data ) {
            var json = $.parseJSON(data);
            map.setCenter(new google.maps.LatLng(json.latitude, json.longitude));

            $( "#addressInput" ).val( json.address );
            $( "#latitudeInput" ).val( json.latitude );
            $( "#longitudeInput" ).val( json.longitude );
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
            alert( "Request failed: " + textStatus + " " + errorThrown );
        });
    }

    $(".clickablePlace").click(function() {
        var placeId = $(this).attr('id');
        var uri;

        if (placeId == 'clientPosition') {
            updateFromClientInfo();
        } else {
            updateFromPlaceId(placeId);
        }
    });
</script>

</html>